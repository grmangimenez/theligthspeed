{% extends 'home/crm/base.html' %}

{% block content %}
<div class="card">
    <div class="card-header">
        <h2>{% if oportunidad %}Editar Oportunidad{% else %}Nueva Oportunidad{% endif %}</h2>
    </div>
    
    <form method="post">
        {% csrf_token %}
        
        <div class="form-group">
            <label for="titulo">TÃ­tulo *</label>
            <input type="text" id="titulo" name="titulo" value="{% if oportunidad %}{{ oportunidad.titulo }}{% endif %}" required>
        </div>
        
        <div class="form-group">
            <label for="valor">Valor *</label>
            <input type="number" id="valor" name="valor" step="0.01" min="0" value="{% if oportunidad %}{{ oportunidad.valor }}{% endif %}" required>
        </div>
        
        <div class="form-group">
            <label for="estado">Estado *</label>
            <select id="estado" name="estado" required>
                {% for estado_code, estado_name in estados %}
                    <option value="{{ estado_code }}" {% if oportunidad and oportunidad.estado == estado_code %}selected{% endif %}>{{ estado_name }}</option>
                {% endfor %}
            </select>
        </div>
        
        <div class="form-group">
            <label for="fecha_estimada_cierre">Fecha Estimada de Cierre *</label>
            <input type="date" id="fecha_estimada_cierre" name="fecha_estimada_cierre" 
                   value="{% if oportunidad %}{{ oportunidad.fecha_estimada_cierre|date:'Y-m-d' }}{% endif %}" required>
        </div>
        
        <div class="form-group">
            <label for="contacto">Contacto *</label>
            <select id="contacto" name="contacto" required>
                <option value="">Seleccionar contacto...</option>
                {% for contacto in contactos %}
                    <option value="{{ contacto.id }}" {% if oportunidad and oportunidad.contacto.id == contacto.id %}selected{% endif %}>{{ contacto.nombre }} - {{ contacto.empresa.nombre|default:"Sin empresa" }}</option>
                {% endfor %}
            </select>
        </div>
        
        <div class="form-group">
            <label for="notas">Notas</label>
            <textarea id="notas" name="notas" rows="4">{% if oportunidad %}{{ oportunidad.notas }}{% endif %}</textarea>
        </div>
        
        <div class="form-actions">
            <button type="submit" class="btn btn-success">{% if oportunidad %}Actualizar{% else %}Crear{% endif %}</button>
            <a href="{% url 'oportunidades_list' %}" class="btn btn-secondary">Cancelar</a>
            {% if oportunidad %}
                <a href="{% url 'oportunidad_delete' oportunidad.pk %}" class="btn btn-danger">Eliminar</a>
            {% endif %}
        </div>
    </form>
</div>
{% endblock %}


